# Исправление проблемы с сохранением изменений в Place Editor

## Проблема
Изменения в Place Editor не сохраняются из-за отсутствия RLS (Row Level Security) политик для UPDATE операций в Supabase.

## Решение

### Шаг 1: Откройте Supabase Dashboard

1. Откройте [Supabase Dashboard](https://app.supabase.com)
2. Выберите ваш проект
3. Перейдите в **SQL Editor** (в левом меню)

### Шаг 2: Выполните SQL скрипт

1. Откройте файл `fix-rls-update-policies.sql` из корня проекта
2. Скопируйте весь SQL код
3. Вставьте в SQL Editor
4. Нажмите **Run** (или F5)

### Что делает скрипт:

- ✅ Создает политику UPDATE для таблицы `places` (пользователи могут обновлять свои места)
- ✅ Создает политики для таблицы `place_photos` (SELECT, INSERT, UPDATE, DELETE)
- ✅ Включает RLS для обеих таблиц
- ✅ Показывает все существующие политики

### Шаг 3: Проверьте результат

После выполнения скрипта вы должны увидеть:
- Политику "Users can update their own places" для таблицы `places`
- Политики для таблицы `place_photos`

### Шаг 4: Проверьте в приложении

1. Откройте Place Editor
2. Попробуйте изменить название, описание, категории, локацию или фото
3. Откройте консоль браузера (F12) и проверьте логи
4. Если есть ошибки, они будут показаны в консоли и в интерфейсе

## Отладка

Если изменения все еще не сохраняются:

1. **Откройте консоль браузера** (F12 → Console)
2. **Попробуйте сохранить изменение**
3. **Проверьте логи** - вы увидите:
   - `Saving [field]:` - что сохраняется
   - `Update result:` - результат обновления
   - `Update error:` - ошибки, если есть

4. **Проверьте RLS политики в Supabase:**
   - Dashboard → Authentication → Policies
   - Найдите таблицу `places`
   - Убедитесь, что есть политика UPDATE: `USING (auth.uid() = created_by)`

## Частые ошибки

### "Update succeeded but no data returned. Check RLS policies."
Это означает, что UPDATE выполнился, но RLS политика блокирует возврат данных. Нужно добавить `.select()` в запрос (уже добавлено) и проверить политики.

### "new row violates row-level security policy"
RLS политика блокирует операцию. Убедитесь, что политика UPDATE существует и правильно настроена.

### "column does not exist"
Поле не существует в таблице. Это нормально для premium полей - они будут добавлены позже.

## Дополнительная информация

Все редакторы теперь логируют свои операции в консоль браузера для отладки. Если проблема сохраняется, проверьте:

1. RLS политики в Supabase Dashboard
2. Консоль браузера на наличие ошибок
3. Что пользователь является владельцем места (`created_by` совпадает с `auth.uid()`)
