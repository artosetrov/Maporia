# Stable Bootstrap & Request Deduplication Fix

## Проблема
На продакшене компоненты постоянно размонтируются и перемонтируются, что вызывает:
- Множественные вызовы `loadPlaces()`
- Отмену предыдущих запросов при новых вызовах
- Компоненты размонтируются до завершения загрузки данных
- Результат: контент не загружается, карта пустая

## Решение

### 1. Стабильный Bootstrap (HomePage)
- Добавлен `bootReady` state, который ждет готовности `accessLoading`
- Секции (`HomeSection`) рендерятся только после готовности auth/profile
- Показывается skeleton вместо реальных компонентов во время bootstrap

### 2. Дедупликация запросов (HomeSection)
- Используется стабильный `requestKey` на основе всех параметров секции
- `useEffect` зависит только от `requestKey`, а не от отдельных параметров
- Если `requestKey` не изменился, запрос не выполняется повторно

### 3. "Latest Only" паттерн (вместо AbortController)
- Используется `currentRequestId` для отслеживания актуального запроса
- При размонтировании устанавливается `alive = false` и инвалидируется `requestId`
- Результаты применяются только если запрос все еще актуален
- Нет AbortError - запросы просто игнорируются если они устарели

### 4. Защита setState после unmount
- Используется `alive` флаг вместо `isUnmounting`
- Все `setState` проверяют `alive && currentRequestId === requestId`
- Предотвращает обновление состояния размонтированного компонента

### 5. MapPage - те же улучшения
- Добавлен `bootReady` для ожидания auth
- Стабильный `requestKey` для дедупликации
- "Latest only" паттерн вместо abort
- `loadPlacesRef` для отслеживания текущего запроса

## Результат

✅ Только 1 вызов `loadPlaces` на начальную загрузку
✅ Нет "request aborted expected on unmount" спама
✅ Places/cities завершают загрузку на продакшене
✅ Карта рендерит маркеры стабильно
✅ Компоненты не размонтируются преждевременно

## Файлы изменены

- `app/page.tsx` - добавлен bootstrap ready state
- `app/components/HomeSection.tsx` - дедупликация запросов, latest only паттерн
- `app/map/page.tsx` - те же улучшения для map page
