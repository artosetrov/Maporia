# Автоматическое исправление RLS политик

⚠️ **ВАЖНО**: Я не могу напрямую подключиться к вашей базе данных Supabase, так как для этого нужны ваши credentials. Но я создал скрипт, который попытается выполнить исправление автоматически, или выведет SQL код для ручного выполнения.

## Способ 1: Автоматический (если есть service_role key)

### Шаг 1: Получите Service Role Key

1. Откройте [Supabase Dashboard](https://app.supabase.com)
2. Выберите ваш проект
3. Перейдите в **Settings** → **API**
4. Найдите **service_role key** (секретный ключ, не anon key!)
5. Скопируйте его

### Шаг 2: Добавьте в .env.local

Откройте файл `.env.local` в корне проекта и добавьте:

```env
NEXT_PUBLIC_SUPABASE_URL=ваш_url_из_dashboard
NEXT_PUBLIC_SUPABASE_ANON_KEY=ваш_anon_key
SUPABASE_SERVICE_ROLE_KEY=ваш_service_role_key_который_вы_скопировали
```

⚠️ **ВАЖНО**: 
- `SUPABASE_SERVICE_ROLE_KEY` - это секретный ключ, НЕ добавляйте его в git!
- Он уже должен быть в `.gitignore`

### Шаг 3: Запустите скрипт

```bash
npm run fix-rls
```

Или напрямую:

```bash
node scripts/fix-rls-policies.mjs
```

### Шаг 4: Проверьте результат

Скрипт выведет:
- ✅ Политика создана успешно
- ✅ RLS включен
- ✅ Готово! RLS политики исправлены

Теперь попробуйте удалить место в приложении!

---

## Способ 2: Ручной (самый надежный) ⭐

Это самый простой и надежный способ:

1. **Откройте [Supabase Dashboard](https://app.supabase.com)**
2. **Выберите ваш проект**
3. **Перейдите в SQL Editor** (в левом меню)
4. **Откройте файл `fix-rls-policies.sql`** из корня проекта
5. **Скопируйте весь SQL код**
6. **Вставьте в SQL Editor**
7. **Нажмите Run** (или F5)

Готово! Теперь попробуйте удалить место в приложении.

---

## Способ 3: Через скрипт (если автоматический не работает)

Если автоматический скрипт не работает:

1. Откройте [Supabase Dashboard](https://app.supabase.com)
2. Перейдите в **SQL Editor**
3. Откройте файл `fix-rls-policies.sql`
4. Скопируйте и выполните SQL код

---

## Если ничего не помогает

Проверьте в Supabase Dashboard → Authentication → Policies:

1. Есть ли политика DELETE для таблицы `places`
2. Правильно ли она настроена: `USING (auth.uid() = created_by)`
3. Не конфликтует ли с другими политиками
